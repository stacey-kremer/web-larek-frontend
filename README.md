# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Интерфейс, который содержит карточку с товаром

```
export interface ISupply {
	id: string;
	name: string;
    about: string;
    price: number | null;
    category: string;
	image: string;
}
```

Интерфейс, который содержит данные о совершённом заказе

```
export interface IOrder {
    email: string;
    phone: string;
    payment: string;
    address: string;
    supplies: string[];
    total: number | null;
}
```

Интерфейс, в котором хранится модель данных корзины

```
export interface ICartModal {
    supplies: TCartSupply[];
    addSupply(supplies: TCartSupply): void;
    removeSupply(supplies: TCartSupply): void;
    getTotalPrice(): number | null;
    clearCart(): void;
}
```

Интерфейс, в котором хранятся краткие данные при успешно совершённой покупке

```
export interface IOrderComplete{
    id: string;
    total: number | null;
}
```

Интерфейс, в которой хранится модель данных карточки с товаром

```
export interface ISuppliesData {
    supplies: ISupply[];
    preview: string | null;
    getAllSupplies(supplies: ISupply[]): ISupply;
    getPreview(supplies: ISupply): ISupply;
}
```

Интерфейс, в котором хранится модель данных пользователя, который совершает заказ

```
export interface IOrderData {
    order: IOrder[];
    getUserContacts(): TOrderContactForm;
    getDeliveryDetails(): TOrderDeliveryForm;
    setUserContacts(contactsData: IOrder): void;
    setDeliveryDetails(deliveryData: IOrder): void;
}
```


Список основных категорий товаров, которые можно приобрести в магазине

```
export type TSupplyCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Данные товара, которые отображаются в корзине

```
export type TCartSupply = Pick<ISupply, 'id' | 'name' | 'price'>;
```

Данные о способе оплаты, который выбрал пользователь

```
export type TPaymentMethod = Pick<IOrder, 'payment'>;
```

Данные, которые используются в форме с доставкой и оплатой

```
export type TOrderDeliveryForm = Pick<IOrder, 'payment' | 'address'>;
```

Данные, которые используются в форме с контактной информацией пользователя

```
export type TOrderContactForm = Pick<IOrder, 'email' | 'phone'>;
```

Краткие данные, которые отобразятся в форме при успешно совершённой покупке

```
export type TOrderCompleteForm = Pick<IOrder, 'total'>;
```

Данные, которые используются для валидации ошибок в форме с доставкой и оплатой

```
export type TErrorDeliveryForm = Partial<Record<keyof TOrderDeliveryForm, string>>;;
```

Данные, которые используются для валидации ошибок в форме с контактной информацией

```
export type TErrorContactForm = Partial<Record<keyof TOrderContactForm, string>>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове
- `handleResponse` - берёт на себя роль обработчика запросов, которые возвращает сервер

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс SupplyData
Класс отвечает за хранение данных, которые содержатся в карточках с товарами и логику работы с этими данными.\
В полях класса хранятся следующие данные:
- supplies: ISupply[] - массив объектов карточек с товарами
- preview: string | null - id карточки, которую пользователь выбрал для просмотра в модальном окне

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getAllSupplies(supplies: ISupply[]): ISupply; - возвращает карточки с сервера, если событие сработало правильным образом
- getPreview(supplies: ISupply): ISupply; - возвращает конкретную карточку по её id.
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными пользователя, который планирует совершить заказ.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- order: IOrder[] - массив, который содержит все данные заказа
- errorDeliveryForm: TErrorDeliveryForm {} - возвращает пустой объект для валидации ошибок в форме с доставкой и способом оплаты
- errorContactForm: TErrorContactForm {} - возвращает пустой объект для валидации ошибок в форме с контактной информацией пользователя
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getUserContacts(): TOrderContactForm - возвращает контактные данные пользователя
- getDeliveryDetails(): TOrderDeliveryForm - возвращает данные пользователя, которые содержат детали адреса доставки и способа оплаты
- setUserContacts(contactsData: IOrder): void - сохраняет контактные данные пользователя в классе
- setDeliveryDetails(deliveryData: IOrder): void - сохраняет данные пользователя, которые содержат детали адреса доставки и способа оплаты
- validateDeliveryForm() - производит валидацию формы c адресом доставки и способом оплаты
- validateContactForm() - производит валидацию формы c контактными данными пользователя

#### Класс CartModal
Класс отвечает за получение и хранение данных карточек, добавленных в корзину, и логику работы с этими карточками(добавление товаров в корзину и их удаление оттуда, очистку корзины и суммирование цен товаров)\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- supplies: TCartSupply[] - массив, который содержит в себе все карточки с товарами, которые пользователь добавил в корзину
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addSupply(supplies: TCartSupply): void - служит для добавления в корзину новой карточки с товаром
- removeSupply(supplies: TCartSupply): void - служит для удаления из корзины карточки с товаром
- getTotalPrice(): number | null - суммирует цены всех товаров в корзине и показывает их общую стоимость
- clearCart(): void - очищает корзину от всех добавленных товаров


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик по оверлею и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

Методы:
- open() - открывает модальное окно
- close() - закрывает модальное окно
- render() - служит для динамического изменения содержимого модального окна без перезагрузки страницы


#### Класс Card 
Отвечает за отображение карточки товара и содержит в себе данные о товаре(изображение товара, категория товара, наименование товара, описание товара, цена товара). Класс используется для правильного отображения карточек с товарами на странице магазина. В конструктор класса передается DOM-элемент темплейта, что послужит хорошей практикой, так как его можно использовать многократно без копирования кода. На интерактивные элементы устанавливаются слушатели событий, которые будут генерировать события при взаимодействии пользователя с ними.\
Методы:
- setData(supplyData: ISupply: string): void - заполняет атрибуты элементов карточки данными
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями
- геттер id возвращает уникальный id карточки

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки.

#### Класс ModalWithCard
Расширяет класс Modal. Предназначен для реализации модального окна с карточкой товара в большом размере. При открытии модального окна получает подробные данные карточки с товаром, которые нужно показать. Товар можно добавить в корзину\
Поля класса:
- supplyElement: HTMLElement - элемент разметки с карточкой товара
- addSupplyButton: HTMLButtonElement - кнопка добавления товара в корзину

Методы:
- open(data: ISupply): void - расширяет родительский метод, принимает данные карточки с товаром, которые используются для заполнения атрибутов элементов модального окна
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна
- changeButtonState(): void - изменяет состояние кнопки при условии, что товар уже был добавлен в корзину

#### Класс ModalCart
Расширяет класс Modal. Предназначен для реализации модального окна с корзиной. При открытии модального окна отображает список товаров, добавленных в корзину и показывает их общую стоимость. Товары можно удалить из корзины. При сабмите переводит пользователя на следующее модальное окно, в котором нужно будет заполнить данные для оформления заказа. 
Поля класса:
- supplyElement[]: HTMLElement[] - массив, состоящий из товаров, которые пользователь добавил в корзину
- deleteSupplyButton: HTMLButtonElement - кнопка удаления товара из корзины
- submitButton: HTMLButtonElement - кнопка оформления заказа
- totalSum: string - элемент, состоящий из одной строки, в которой отображается общая стоимость товаров, добавленных в корзину

Методы:
- open(data: ICartModal): void - расширяет родительский метод, принимает данные о том, какие товары были добавлены в корзину, и использует эти данные для заполнения атрибутов элементов модального окна 
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна
- getTotalPrice(): number | null - суммирует цены  всех товаров, добавленных в корзину, и показывает итоговое значение

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей поля ввода. При сабмите инициирует событие, осуществляя передачу объекта с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close(): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс DeliveryModal
Расширяет класс ModalWithForm. Предназначен для реализации модального окна, которое будет содержать радио-кнопку для выбора способа оплаты и форму с адресом пользователя. В конструктор класса передается DOM-элемент темплейта. На интерактивные элементы устанавливаются слушатели событий, которые будут генерировать события при взаимодействии пользователя с ними
\
Поля класса:
- addressForm: HTMLFormElement - расширяет родительский элемент формы, содержит в себе адрес пользователя
- paymentRadioButton: HTMLButtonElement - переключатель, который отвечает за выбор способа оплаты

Методы:
- setDeliveryDetails(deliveryData: IOrder): void - заполняют атрибуты элементов формы необходимыми данными
- getDeliveryDetails(): void - возвращают значения, которые были введены в элементы формы

#### Класс ContactModal
Расширяет класс ModalWithForm. Предназначен для реализации модального окна, которое будет содержать в себе две формы: форма, в которую пользователь вводит свой Email и форма, в которой пользователь оставляет свой номер телефона. В конструктор класса передается DOM-элемент темплейта. На интерактивные элементы устанавливаются слушатели событий, которые будут генерировать события при взаимодействии пользователя с ними\
Поля класса:
- emailForm - расширяет родительский элемент формы, содержит в себе Email пользователя
- phoneNumberForm - расширяет родительский элемент формы, содержит в себе номер телефона пользователя

Методы:
- setUserContacts(contactsData: IOrder): void - заполняют атрибуты элементов формы необходимыми данными
-  getUserContacts(): void - возвращают значения, которые были введены в элементы формы

#### Класс CompleteOrderModal
Расширяет класс Modal. Предназначен для реализации модального окна с оповещением о том, что покупка была успешно совершена и заказ оформлен. Содержит в себе данные о том, какая сумма была списана с кошелька пользователя после совершённой покупки. В конструктор класса передается DOM элемент, что позволяет при необходимости формировать разные варианты верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса:
- image: HTMLImageElement - отображает иконку, оповещающую об успешной покупке
- totalSum: string - элемент, состоящий из одной строки, в которой отображается сумма, которая была списана с кошелька пользователя в результате совершения покупки

Методы:
- сетттеры - заполняют атрибуты элементов формы данными


### Слой коммуникации

#### Класс MarketApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `supply:selected` - изменение открываемой в модальном окне картинки карточки
- `addSupplyToCart:changed` - добавление товара в корзину
- `removeSupplyOffCart:changed` - удаление товара из корзины
- `cart:changed` - изменения данных в корзине
- `supply:changed` - изменения в карточке товара при добавлении/удалении товара из корзины
- `deliveryForm:changed` - изменилось одно из полей формы доставки и оплаты
- `contactForm:changed` - изменилось одно из полей формы контактных данных
- `paymentMethod:changed` - изменение способа оплаты
- `deliveryFormError:changed` - изменение в состоянии валидации форм доставки и оплаты
- `contactForm:changed` - изменение в состоянии валидации форм контактных данных

- `supply:open` - открытие модального окна с карточкой
- `cart:open` - открытие модального окна с корзиной

- `cart:submit` - сохранение данных корзины и переход к модальному окну с формой адреса доставки и способа оплаты
- `deliveryForm:submit` - сохранение данных с адресом пользователя и способом оплаты и переход к модальному окну с контактными данными пользователя
- `contactForm:submit` - сохранение данных с контактной информацией пользователя и переход к модальному окну успешно совершенного заказа